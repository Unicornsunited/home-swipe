"use strict";

angular.module('lists', []);
angular.module('dragEventsService', []);
angular.module('houses.data', []);
angular.module('houses.button', []);
angular.module('houses.dating', ['lists', 'dragEventsService']);
angular.module('house-dating', ['ui.router', 'houses.data', 'houses.dating']);
(() => {
    angular.module('house-dating').run(run).config(config);

    function run($rootScope, $state, $document) {
        $rootScope.$state = $state;
        $rootScope.apiUrl = {
            base: "/api",
            user: "/user"
        };
        $rootScope.url = {
            icons: "src/icons/"
        };

        $document.on('click', function () {
            $rootScope.$broadcast('bodyClick');
        });
    }

    function config($stateProvider, $urlRouterProvider) {
        $urlRouterProvider.otherwise("/");

        $stateProvider.state('base', {
            abstract: true,
            views: {
                top: {
                    templateUrl: "dist/templates/top.html"
                }
            }
        }). // controller: "topCtrl"
        state('base.dating', {
            url: "/",
            resolve: {
                data: property => {
                    return property.getListing();
                }
            },
            views: {
                'mainContent@': {
                    templateUrl: "dist/templates/dating.html",
                    controller: "datingCtrl"
                }
            }
        });
    };
})();

(() => {
    angular.module('dragEventsService').directive('dragMe', dragMe);

    function dragMe() {
        return {
            restrict: "A",
            scope: {
                dragMe: "="
            },
            link: dragMeLink
        };
    }

    function dragMeLink($scope, $elem) {
        const _dragMeDefaults = {
            dragX: true,
            dragY: false
        };

        $scope._translate = {
            x: 0,
            y: 0
        };

        for (var i = 0; i < _dragMeDefaults.length; i++) {
            if (!$scope.dragMe[i]) {
                $scope.dragMe[i] = _dragMeDefaults[i];
            }
        }

        $elem.bind('mousedown', function (t) {
            $elem.bind('mousemove', function (mousePosition) {
                if ($scope.dragMe.dragX) {
                    $scope._translate.x = $scope._translate.x + mousePosition.movementX;
                }
                if ($scope.dragMe.dragY) {
                    $scope._translate.y = $scope._translate.y + mousePosition.movementY;
                }

                $elem.css({
                    transform: `translate3D(${ $scope._translate.x }, ${ $scope._translate.y })`
                });
            });
        });
    }
})();
(() => {
    angular.module('lists').factory('listService', listService);

    function listService() {
        return {
            addToList: addToList,
            removeFromList: removeFromList
        };

        function addToList(id, targetListName) {
            let targetListCache = [];
            if (window.localStorage.getItem(targetListName)) {
                targetListCache = JSON.parse(window.localStorage.getItem(targetListName));
            }

            targetListCache.push(id);

            window.localStorage.setItem(targetListName, JSON.stringify(targetListCache));
        }

        function removeFromList(id, targetList) {
            if (typeof targetList === 'string') {
                if (window.localStorage.getItem(targetList)) {
                    targetList = JSON.parse(window.localStorage.getItem(targetList));
                } else {
                    targetList = [];
                }
            }

            if (targetList.length && targetList[id]) {
                targetList.splice(id, 1);
            }

            if (window.localStorage.getItem(targetList)) {
                window.localStorage.setItem(id, JSON.stringify(targetList));
            }
        }
    }
})();
(() => {
    angular.module('houses.data').factory('property', function ($http, $q) {
        function getProperty(_url, _data) {
            var data = {
                api_key: "gndny3sqrvsgx483wpamyqe4",
                callback: "JSON_CALLBACK"
            },
                url = "/api/";

            angular.extend(data, _data);

            url = url + _url + ".json";

            var def = $q.defer();

            $http({
                'url': url,
                'method': 'GET',
                'params': data
            }).success(function (data) {
                def.resolve({
                    'status': 'success',
                    'data': data
                });
            });

            return def.promise;
        }

        function getListing(_data) {
            return getProperty("property_listings", {
                postcode: 'sw4',
                area: 'London',
                listing_status: 'rent',
                minimum_price: 50,
                maximum_price: 500,
                order_by: 'age',
                page_size: 60
            });
        }

        function getHouse(id) {
            return getProperty("property_listings", {
                listing_id: id
            });
        }

        return {
            getListing: getListing,
            getHouse: getHouse
        };
    });
})();
(() => {
    angular.module('houses.dating').controller('datingCtrl', datingCtrl);

    function datingCtrl($scope, data, listService) {
        let cards = data.data.listing;
        $scope.cards = cards.splice(0, 5);
        cards.splice(0, 5);

        $scope.moveCardToList = (id, targetListName) => {
            listService.addToList(id, targetListName);
            listService.removeFromList(0, $scope.cards);
            $scope.cards.push(cards[0]);
            cards.splice(0, 1);
        };
    }
})();

//# sourceMappingURL=app.min.js.map
//# sourceMappingURL=app.min.js.map
